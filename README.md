# Ход работы (как повторить).

<h2>Node.js вместе с Nest.js и создание проекта.</h2>

Вначале устанавливаем фреймворк `Node.js` через стандартный установщик с официального сайта (это самый простой способ).
____
Затем создаём каркас проекта с помощью Nest CLI.

Чтобы создать каркас проекта с помощью командной строки Nest, выполняем следующую команду:

`$ npm i -g @nestjs/cli`
____
Далее создаём новый каталог проекта и заполняем его исходными файлами core Nest и вспомогательными модулями, создавая обычную базовую структуру для проекта (взято название «nestproject»):

`$ nest new nestproject`

Генерация нового проекта в Nest.js сопровождается добавлением новых файлов:

•	app.controller.ts – базовый (basic) контроллер с одним роутом (обработчиком маршрута или пути);

•	app.controller.spec.ts – юнит-тесты для контроллера;

•	app.module.ts – корневой (root) модуль приложения;

•	app.service.ts – базовый сервис с одним методом;

•	main.ts – входной (entry) файл приложения, в котором используется класс NestFactory для создания экземпляра приложения Nest.
____
Для того чтобы запустить это приложение, переходим через терминал в папку с проектом «nestproject» (или можно придумать любое другое название) и выполняем в терминале такую команду:

`$ npm start`

или (лучше):

`$ npm run start` – так будет стартовать по скриптам из package.json.

Для проверки сервера открываем какой-нибудь браузер и вводим в адресной строке http://127.0.0.1:3000 (или http://localhost:3000), то есть – тот адрес сервера, который будет выведен в консоли после его успешного запуска. Если всё работает как надо – на странице будет выведено «Hello World!» и то, что вы ещё могли дописать.
____
<h2>JWT-аутентификация и авторизация.</h2>

В разделе **"Смотрите также"**, который будет в конце, будет приведена ссылка на статью, по которой делалась эта лабораторная работа, а пока мы рассмотрим некоторые аспекты, которые выходили за пределы этой статьи.

В статье использовался `curl`, но с ним вытворялась ерунда разного типа, поэтому мы не стали возиться с его тонкостями и просто взяли [Postman](https://www.postman.com/downloads/), в котором создали запрос по адресу:

`http://localhost:3000/auth/login`

<b>*Примечание: Такой адрес у вас будет, если вы делали всё по той статье, иначе если вы вписали другой путь, то и у вас он, соответственно будет другой. Будьте внимательны!*</b>

И… Здесь есть 2 способа для отправки `username` (`login`) и `password`:

1) `Желательно` Впихнуть их в `Body` -> `raw (JSON)`, например:

```JSON
{
    "username": "john",
    "password": "changeme"
}
```

2) `Просто` Впихнуть их в `Body` -> `x-www-form-urlencoded`, например:

![2022-12-22_17-01-16](https://user-images.githubusercontent.com/70268003/209150811-cc256410-8178-4520-b586-a2e2b895df63.png)
____
После этого вам, если у вас всё правильно настроено, должен прийти `access_token`, благодаря которому вы сможете уже авторизоваться в течении N секунд (в нашем случае – 30-ти).

Далее можно продолжать пытаться получить профиль по статье с помощью `curl`, но если вас всё так же тянет использовать великий и могучий [Postman](https://www.postman.com/downloads/), то там нужно уже будет по адресу:

`http://localhost:3000/profile`

<b>*Примечание: Будьте внимательны с адресом!*</b>

Отправить пакет с дополнительным Header во вкладке `Headers`:

`"Authorization": "Bearer <ваш JWT-токен>"`

Пример:

```JSON
"Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImpvaG4iLCJzdWIiOjEsImlhdCI6MTY3MTY0MTgyNCwiZXhwIjoxNjcxNjQxODU0fQ.8l4hr6gJWSaKeOpI6ghS6jY_oCekslWbMEqjy15VoIw",
```

<b>*Примечание: Ключевое слово `Bearer` – обязательно должно присутствовать!*</b>

После этого, **если вы успели отправить пакет для авторизации в течении N секунд**, должен прилететь пакет, в котором должен будет фигурировать ответ, по типу:

```JSON
{
    "userId": 1,
    "username": "john"
}
```

В `curl`, как не странно, это тоже нормально отработает.
____
Вроде всё просто!
____
<h2>Смотрите также:</h2>

<h4>Статьи:<h4>

[Аутентификация | Nest.js](https://nestjs.ru/security/authentication#расширение-защиты) (здесь подробно описан каждый шаг для этого и даже – больше).